import{t as F,c$ as D,u as P,r as a,e as o,j as t}from"./index.dc8861ba.js";import{y as n}from"./index.7f582228.js";import{U as B}from"./index.f70f7227.js";import{E as C}from"./eye-off.75682f07.js";import{E as N}from"./eye.41660a03.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};const S=async e=>{const u=new FormData;return u.append("avatar",e),(await F.post(D.uploadAvatar(),u)).data};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};const q=({currentPhotoUrl:e,onPhotoUpdate:u})=>{const{t:i}=P(),[c,g]=a.exports.useState(!1),[f,d]=a.exports.useState(e),[p,m]=a.exports.useState(null);a.exports.useEffect(()=>{d(e)},[e]);const w=l=>{var b;const r=(b=l.target.files)==null?void 0:b[0];if(!r)return;if(!r.type.startsWith("image/")){n.error("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435");return}if(r.size>5*1024*1024){n.error("\u0420\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 \u043D\u0435 \u0434\u043E\u043B\u0436\u0435\u043D \u043F\u0440\u0435\u0432\u044B\u0448\u0430\u0442\u044C 5MB");return}m(r);const s=new FileReader;s.onload=()=>{d(s.result)},s.readAsDataURL(r)},y=async()=>{var l,r;if(!p){n.error("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0430\u0439\u043B");return}g(!0);try{await S(p),n.success("\u0424\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u044F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430"),m(null),u&&await u()}catch(s){n.error(((r=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:r.message)||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438"),console.error(s),d(e),m(null)}finally{g(!1)}};return o("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[o("h2",{className:"text-lg font-semibold mb-6",children:[" ",i("cm:settings.changePhoto")]}),o("div",{className:"flex flex-col items-center",children:[t(B,{imageUrl:f,size:"lg"}),o("div",{className:"mt-6",children:[t("label",{htmlFor:"profile-photo",className:"px-4 text-sm font-medium text-blue-600  cursor-pointer",children:i("cm:actions.edit")}),t("input",{type:"file",id:"profile-photo",accept:"image/*",onChange:w,disabled:c,className:"hidden"}),t("button",{type:"button",onClick:y,className:"mt-4 px-6 py-2 text-sm font-medium text-white bg-[#1567DA] border-none rounded-lg hover:bg-[#FF6B00] transition-colors disabled:opacity-50",disabled:c||!p,children:i(c?"cm:actions.saving":"cm:actions.save")})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};const j=async e=>(await F.post(D.changePassword(),{old_password:e.oldPassword,new_password:e.newPassword})).data;globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};const L=()=>{const{t:e}=P(),[u,i]=a.exports.useState(""),[c,g]=a.exports.useState(""),[f,d]=a.exports.useState(""),[p,m]=a.exports.useState(!1),[w,y]=a.exports.useState(!1),[l,r]=a.exports.useState(!1),[s,b]=a.exports.useState(!1),A=async h=>{var E,v;if(h.preventDefault(),c.length<6){n.error("\u041D\u043E\u0432\u044B\u0439 \u043F\u0430\u0440\u043E\u043B\u044C \u0434\u043E\u043B\u0436\u0435\u043D \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0442\u044C \u043A\u0430\u043A \u043C\u0438\u043D\u0438\u043C\u0443\u043C 6 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432");return}if(c!==f){n.error("\u041F\u0430\u0440\u043E\u043B\u0438 \u043D\u0435 \u0441\u043E\u0432\u043F\u0430\u0434\u0430\u044E\u0442");return}m(!0);try{await j({oldPassword:u,newPassword:c}),n.success("\u041F\u0430\u0440\u043E\u043B\u044C \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0438\u0437\u043C\u0435\u043D\u0435\u043D"),i(""),g(""),d("")}catch(x){n.error(((v=(E=x==null?void 0:x.response)==null?void 0:E.data)==null?void 0:v.message)||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0438 \u043F\u0430\u0440\u043E\u043B\u044F"),console.error(x)}finally{m(!1)}};return o("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[t("h2",{className:"text-lg font-semibold mb-4",children:e("cm:settings.changePassword")}),t("p",{className:"text-sm text-gray-500 mb-6",children:e("cm:settings.changePasswordDescription")}),o("form",{onSubmit:A,className:"space-y-2.5",children:[o("div",{className:"flex items-center gap-3 border border-gray-300 rounded-lg px-3 py-2 focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500",children:[t("input",{type:w?"text":"password",value:u,onChange:h=>i(h.target.value),placeholder:e("auth:form.oldPassword")||"",required:!0,className:"flex-1 text-sm outline-none border-none"}),t("button",{type:"button",onClick:()=>y(!w),className:"flex-shrink-0 bg-transparent border-none cursor-pointer",children:w?t(C,{className:"w-5 h-5 text-gray-400"}):t(N,{className:"w-5 h-5 text-gray-400"})})]}),o("div",{className:"flex items-center gap-3 border border-gray-300 rounded-lg px-3 py-2 focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500",children:[t("input",{type:l?"text":"password",value:c,onChange:h=>g(h.target.value),placeholder:e("auth:form.newPassword")||"",required:!0,minLength:6,className:"flex-1 text-sm outline-none border-none"}),t("button",{type:"button",onClick:()=>r(!l),className:"flex-shrink-0 bg-transparent border-none cursor-pointer",children:l?t(C,{className:"w-5 h-5 text-gray-400"}):t(N,{className:"w-5 h-5 text-gray-400"})})]}),o("div",{className:"flex items-center gap-3 border border-gray-300 rounded-lg px-3 py-2 focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500",children:[t("input",{type:s?"text":"password",value:f,onChange:h=>d(h.target.value),placeholder:e("auth:form.passwordConfirm")||"",required:!0,minLength:6,className:"flex-1 text-sm outline-none border-none"}),t("button",{type:"button",onClick:()=>b(!s),className:"flex-shrink-0 bg-transparent border-none cursor-pointer",children:s?t(C,{className:"w-5 h-5 text-gray-400"}):t(N,{className:"w-5 h-5 text-gray-400"})})]}),t("div",{className:"flex justify-end",children:t("button",{type:"submit",disabled:p,className:"px-6 py-2 text-sm font-medium text-white bg-[#1567DA] border-none rounded-lg hover:bg-[#FF6B00] cursor-pointer",children:e(p?"cm:actions.saving":"cm:actions.save")})})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};export{L as C,q as U};
