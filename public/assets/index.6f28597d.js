import{t as b,v as I,w as k,r as A,u as M,e as h,j as o,h as F,x as w,B as v,L as P,f as O}from"./index.dc8861ba.js";import{F as m}from"./index.183fa59f.js";import{E as U}from"./eye-off.75682f07.js";import{E as D}from"./eye.41660a03.js";import{T as L}from"./index.7d0c3fe5.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const B={signIn:()=>"/auth/login",getAuthInfo:()=>"/auth/info"};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const G=async e=>{var n;let t;console.log("API baseURL:",b.defaults.baseURL);try{t=await b.post(B.signIn(),{login:e.login,password:e.password,role:e.role}),console.log("postSignIn response:",t);const s=t.data.tokenType,f=t.data.token,l=t.data.authState.exp,c=`${s} ${f}`;console.log("Saving token to localStorage:",c),console.log("Token key:","EDUGATE_TOKEN"),localStorage.setItem("EDUGATE_TOKEN",JSON.stringify(c)),localStorage.setItem("EDUGATE_TOKEN_TTL",JSON.stringify(l)),console.log("Token saved. Check localStorage:",localStorage.getItem("EDUGATE_TOKEN"))}catch(s){console.error("postSignIn error:",s),t=(n=s==null?void 0:s.response)==null?void 0:n.data}return t};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const z=({onSignIn:e})=>{const t=I(),[n,s]=k(),[f,l]=A.exports.useState(!1),[c,j]=A.exports.useState(!1),{t:r}=M(),[d]=m.useForm(),C=n.get("external"),y=n.get("role"),T=y==="mon"?2:y==="vuz"?3:5,S=T===2?"auth:login.MON":T===3?"auth:login.VUZ":"auth:login.Applicant",N=i=>{e(i),C&&s(a=>(a.delete("myParam"),a))},E=async i=>{try{l(!0);const a=await i();if(!a){t.openNotification({message:a&&a.message,type:"error"});return}const{data:g,error:u,message:p}=a;if(u||!g){t.openNotification({message:p,type:"error"});return}N(g)}catch(a){console.error("Error during sign in:",a),t.openNotification({message:a==null?void 0:a.message,type:"error"})}finally{l(!1)}},x=async()=>{var u,p;const i=(u=d.getFieldValue("login"))==null?void 0:u.trim(),a=(p=d.getFieldValue("password"))==null?void 0:p.trim(),g={login:i,password:a,role:T};if(!i||!a){t.openNotification({message:"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0432\u0441\u0435 \u043F\u043E\u043B\u044F!",type:"error"});return}await E(()=>G(g))};return h("div",{className:"grid gap-10",children:[t.contextHolder,h(L.Title,{level:4,className:"text-center flex items-center justify-center gap-2",children:[o(F,{}),r(S)]}),h(m,{onFinish:x,form:d,children:[o(m.Item,{rules:[{required:!0,message:r("notify.full")||""}],name:"login",children:o(w,{placeholder:r("auth:login.loginINN")||""})}),o(m.Item,{rules:[{required:!0,message:r("notify.full")||""}],name:"password",children:o(w,{type:c?"text":"password",placeholder:r("auth:login.yourPassword")||"",suffix:o("button",{type:"button",onClick:()=>j(!c),className:"bg-transparent border-none cursor-pointer p-0 flex items-center",children:c?o(U,{className:"w-5 h-5 text-gray-400"}):o(D,{className:"w-5 h-5 text-gray-400"})})})}),h("div",{className:"flex flex-col gap-6 items-center mt-8 ",children:[o(v,{type:"primary",size:"large",htmlType:"submit",className:"w-full !bg-[#1567DA] hover:!bg-[#1557BA] border-none",loading:f,children:r("auth:buttons.signIn")}),h("div",{children:[" ",h(P,{to:O.register,children:[" ",r("auth:form.register")]})]})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};export{z as S};
